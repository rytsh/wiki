import{_ as s,o as a,c as e,R as n}from"./chunks/framework.L2Aq6yRA.js";const m=JSON.parse('{"title":"QEMU","description":"","frontmatter":{},"headers":[],"relativePath":"development/kubernetes/qemu.md","filePath":"development/kubernetes/qemu.md","lastUpdated":1701994294000}'),o={name:"development/kubernetes/qemu.md"},l=n(`<h1 id="qemu" tabindex="-1">QEMU <a class="header-anchor" href="#qemu" aria-label="Permalink to &quot;QEMU&quot;">​</a></h1><p>Qemu is perfect for creating virtual machines.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#C3E88D;"> apt-get</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> -y</span><span style="color:#C3E88D;"> qemu-system</span><span style="color:#C3E88D;"> ovmf</span></span></code></pre></div><p><a href="https://www.qemu.org/docs/master/system/qemu-manpage.html" target="_blank" rel="noreferrer">https://www.qemu.org/docs/master/system/qemu-manpage.html</a></p><h2 id="create-disk" tabindex="-1">Create Disk <a class="header-anchor" href="#create-disk" aria-label="Permalink to &quot;Create Disk&quot;">​</a></h2><p>qemu-img command to create qcow2 disk image, it will not allocate all space at once.</p><p><a href="https://linux.die.net/man/1/qemu-img" target="_blank" rel="noreferrer">https://linux.die.net/man/1/qemu-img</a></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">qemu-img</span><span style="color:#C3E88D;"> create</span><span style="color:#C3E88D;"> -f</span><span style="color:#C3E88D;"> qcow2</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">disk1.qcow2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">1T</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h2 id="network" tabindex="-1">Network <a class="header-anchor" href="#network" aria-label="Permalink to &quot;Network&quot;">​</a></h2><p>Create a network card and attach it.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#EEFFFF;">PROFILE_IN_NETWORK_X1P1</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,net=10.10.1.0/24,dhcpstart=10.10.1.20,ipv4</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">-device</span><span style="color:#C3E88D;"> pci-bridge,id=pci.01,chassis_nr=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">,addr=</span><span style="color:#F78C6C;">06</span><span style="color:#C3E88D;">,shpc=off</span></span>
<span class="line"><span style="color:#FFCB6B;">-netdev</span><span style="color:#C3E88D;"> user,id=X1P1</span><span style="color:#89DDFF;">\${</span><span style="color:#EEFFFF;">PROFILE_IN_NETWORK_X1P1</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">-device</span><span style="color:#C3E88D;"> e1000,netdev=X1P1,bus=pci.01,mac=</span><span style="color:#F78C6C;">00</span><span style="color:#C3E88D;">:11:22:33:44:AA</span></span></code></pre></div><h2 id="port-forwarding" tabindex="-1">Port Forwarding <a class="header-anchor" href="#port-forwarding" aria-label="Permalink to &quot;Port Forwarding&quot;">​</a></h2><p>Add exra port forwarding option to netdev option.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">,hostfwd</span><span style="color:#EEFFFF;">=tcp:8822-:22</span></span></code></pre></div><h2 id="boot-from-iso" tabindex="-1">Boot from ISO <a class="header-anchor" href="#boot-from-iso" aria-label="Permalink to &quot;Boot from ISO&quot;">​</a></h2><p>Qemu to run iso file we need to add cd drive in our start script. Add bootindex=2 to make it boot from cd if bootindex=1 is not found.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">-device</span><span style="color:#C3E88D;"> ide-cd,drive=cdx,bootindex=</span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;"> -drive</span><span style="color:#C3E88D;"> if=none,id=cdx,file=./iso/netinstall.iso,cache=unsafe,format=raw</span><span style="color:#EEFFFF;"> \\</span></span></code></pre></div><h2 id="start-qemu" tabindex="-1">Start Qemu <a class="header-anchor" href="#start-qemu" aria-label="Permalink to &quot;Start Qemu&quot;">​</a></h2><p>Usually you need to make a script to start qemu, and you can use virt-manager.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">qemu-system-x86_64</span><span style="color:#EEFFFF;">  \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -machine</span><span style="color:#C3E88D;"> pc,accel=kvm</span><span style="color:#EEFFFF;">           \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -cpu</span><span style="color:#C3E88D;"> host</span><span style="color:#EEFFFF;">                       \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -m</span><span style="color:#F78C6C;"> 32</span><span style="color:#C3E88D;">G</span><span style="color:#EEFFFF;">                          \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -enable-kvm</span><span style="color:#EEFFFF;">                     \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -nodefaults</span><span style="color:#EEFFFF;">                     \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -bios</span><span style="color:#C3E88D;"> /usr/share/ovmf/OVMF.fd</span><span style="color:#EEFFFF;">   \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -device</span><span style="color:#C3E88D;"> pci-bridge,id=pci.01,chassis_nr=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">,addr=</span><span style="color:#F78C6C;">06</span><span style="color:#C3E88D;">,shpc=off</span><span style="color:#C3E88D;"> -netdev</span><span style="color:#C3E88D;"> user,id=X1P1,net=</span><span style="color:#F78C6C;">10.10</span><span style="color:#C3E88D;">.1.0/24,dhcpstart=</span><span style="color:#F78C6C;">10.10</span><span style="color:#C3E88D;">.1.20,ipv4</span><span style="color:#C3E88D;"> -device</span><span style="color:#C3E88D;"> e1000,netdev=X1P1,bus=pci.01,mac=</span><span style="color:#F78C6C;">00</span><span style="color:#C3E88D;">:11:22:33:44:AA</span><span style="color:#EEFFFF;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -vnc</span><span style="color:#C3E88D;"> :0</span><span style="color:#C3E88D;"> -k</span><span style="color:#C3E88D;"> en-us</span><span style="color:#C3E88D;"> -nographic</span><span style="color:#C3E88D;"> -vga</span><span style="color:#C3E88D;"> std</span><span style="color:#EEFFFF;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -drive</span><span style="color:#C3E88D;"> if=none,id=disk1,file=/mnt/e/VM/disk1.qcow2,cache=unsafe</span><span style="color:#C3E88D;"> -device</span><span style="color:#C3E88D;"> ide-hd,drive=disk1,bootindex=</span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -watchdog</span><span style="color:#C3E88D;"> i6300esb</span><span style="color:#C3E88D;"> -watchdog-action</span><span style="color:#C3E88D;"> none</span><span style="color:#EEFFFF;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">    -boot</span><span style="color:#C3E88D;"> menu=on,once=d</span></span></code></pre></div><h2 id="vnc" tabindex="-1">VNC <a class="header-anchor" href="#vnc" aria-label="Permalink to &quot;VNC&quot;">​</a></h2><p>You can use mobaxterm, tigervnc or any other vnc client to connect to qemu.<br> 5900 is the default port for qemu vnc.</p>`,23),p=[l];function t(c,r,i,d,y,F){return a(),e("div",null,p)}const u=s(o,[["render",t]]);export{m as __pageData,u as default};
