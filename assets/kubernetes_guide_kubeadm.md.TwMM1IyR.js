import{_ as s,o as a,c as e,R as n}from"./chunks/framework.07BXFssY.js";const h=JSON.parse('{"title":"Kubeadm","description":"","frontmatter":{},"headers":[],"relativePath":"kubernetes/guide/kubeadm.md","filePath":"kubernetes/guide/kubeadm.md","lastUpdated":1701909486000}'),o={name:"kubernetes/guide/kubeadm.md"},t=n(`<h1 id="kubeadm" tabindex="-1">Kubeadm <a class="header-anchor" href="#kubeadm" aria-label="Permalink to &quot;Kubeadm&quot;">​</a></h1><p>Afterinitialize kubeadm we can create new join token with kubeadm tool</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">kubeadm</span><span style="color:#E6DB74;"> token</span><span style="color:#E6DB74;"> create</span><span style="color:#AE81FF;"> --print-join-command</span></span></code></pre></div><h2 id="join-to-the-existing-cluster" tabindex="-1">Join to the existing cluster <a class="header-anchor" href="#join-to-the-existing-cluster" aria-label="Permalink to &quot;Join to the existing cluster&quot;">​</a></h2><p>First use kubeadm tool to generate token or you can list it. You can use it in management machine also it uses kubeconfig.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">kubeadm</span><span style="color:#E6DB74;"> token</span><span style="color:#E6DB74;"> create</span></span>
<span class="line"><span style="color:#88846F;"># kubeadm token list</span></span></code></pre></div><p>After that get <code>--discovery-token-ca-cert-hash</code></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">openssl</span><span style="color:#E6DB74;"> x509</span><span style="color:#AE81FF;"> -pubkey</span><span style="color:#AE81FF;"> -in</span><span style="color:#E6DB74;"> /etc/kubernetes/pki/ca.crt</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> openssl</span><span style="color:#E6DB74;"> rsa</span><span style="color:#AE81FF;"> -pubin</span><span style="color:#AE81FF;"> -outform</span><span style="color:#E6DB74;"> der</span><span style="color:#F92672;"> 2&gt;</span><span style="color:#E6DB74;">/dev/null</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> openssl</span><span style="color:#E6DB74;"> dgst</span><span style="color:#AE81FF;"> -sha256</span><span style="color:#AE81FF;"> -hex</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> sed</span><span style="color:#E6DB74;"> &#39;s/^.* //&#39;</span></span></code></pre></div><p>And use join command</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">kubeadm</span><span style="color:#E6DB74;"> join</span><span style="color:#E6DB74;"> cluster.kube-cluster:6443</span><span style="color:#AE81FF;"> --token</span><span style="color:#AE81FF;"> 3</span><span style="color:#E6DB74;">k2xfX.XXXXXXXXXXXXXXXX</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">    --discovery-token-ca-cert-hash</span><span style="color:#E6DB74;"> sha256:4eb7daf656XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span></code></pre></div><h2 id="join-as-master" tabindex="-1">Join as Master <a class="header-anchor" href="#join-as-master" aria-label="Permalink to &quot;Join as Master&quot;">​</a></h2><p><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-alpha/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-alpha/</a></p><p>Certificate valid 2 hours</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">kubeadm</span><span style="color:#E6DB74;"> alpha</span><span style="color:#E6DB74;"> certs</span><span style="color:#E6DB74;"> certificate-key</span></span></code></pre></div><p>Before to start upload certificates in a master node</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">kubeadm</span><span style="color:#E6DB74;"> init</span><span style="color:#E6DB74;"> phase</span><span style="color:#E6DB74;"> upload-certs</span><span style="color:#AE81FF;"> --upload-certs</span></span>
<span class="line"><span style="color:#88846F;"># use this certificate-key</span></span></code></pre></div><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">kubeadm</span><span style="color:#E6DB74;"> join</span><span style="color:#E6DB74;"> cluster.ecs-cluster:6443</span><span style="color:#AE81FF;"> --token</span><span style="color:#E6DB74;"> wfdwcX.XXXXXXXXXXXXXXXX</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">    --discovery-token-ca-cert-hash</span><span style="color:#E6DB74;"> sha256:4eb7daf656XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">    --control-plane</span><span style="color:#AE81FF;"> --certificate-key</span><span style="color:#E6DB74;"> d5ada6891029051XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span></code></pre></div>`,17),l=[t];function p(c,X,r,i,d,u){return a(),e("div",null,l)}const E=s(o,[["render",p]]);export{h as __pageData,E as default};
