import{_ as s,o as a,c as e,a4 as n}from"./chunks/framework.wXO1VFWK.js";const h=JSON.parse('{"title":"Kubeadm","description":"","frontmatter":{},"headers":[],"relativePath":"development/kubernetes/guide/kubeadm.md","filePath":"development/kubernetes/guide/kubeadm.md","lastUpdated":1701994294000}'),o={name:"development/kubernetes/guide/kubeadm.md"},t=n(`<h1 id="kubeadm" tabindex="-1">Kubeadm <a class="header-anchor" href="#kubeadm" aria-label="Permalink to &quot;Kubeadm&quot;">​</a></h1><p>Afterinitialize kubeadm we can create new join token with kubeadm tool</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> token</span><span style="color:#C3E88D;"> create</span><span style="color:#C3E88D;"> --print-join-command</span></span></code></pre></div><h2 id="join-to-the-existing-cluster" tabindex="-1">Join to the existing cluster <a class="header-anchor" href="#join-to-the-existing-cluster" aria-label="Permalink to &quot;Join to the existing cluster&quot;">​</a></h2><p>First use kubeadm tool to generate token or you can list it. You can use it in management machine also it uses kubeconfig.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> token</span><span style="color:#C3E88D;"> create</span></span>
<span class="line"><span style="color:#546E7A;font-style:italic;"># kubeadm token list</span></span></code></pre></div><p>After that get <code>--discovery-token-ca-cert-hash</code></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> x509</span><span style="color:#C3E88D;"> -pubkey</span><span style="color:#C3E88D;"> -in</span><span style="color:#C3E88D;"> /etc/kubernetes/pki/ca.crt</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> openssl</span><span style="color:#C3E88D;"> rsa</span><span style="color:#C3E88D;"> -pubin</span><span style="color:#C3E88D;"> -outform</span><span style="color:#C3E88D;"> der</span><span style="color:#89DDFF;"> 2&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> openssl</span><span style="color:#C3E88D;"> dgst</span><span style="color:#C3E88D;"> -sha256</span><span style="color:#C3E88D;"> -hex</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> sed</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">s/^.* //</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>And use join command</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> join</span><span style="color:#C3E88D;"> cluster.kube-cluster:6443</span><span style="color:#C3E88D;"> --token</span><span style="color:#F78C6C;"> 3</span><span style="color:#C3E88D;">k2xfX.XXXXXXXXXXXXXXXX</span><span style="color:#EEFFFF;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">    --discovery-token-ca-cert-hash</span><span style="color:#C3E88D;"> sha256:4eb7daf656XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span></code></pre></div><h2 id="join-as-master" tabindex="-1">Join as Master <a class="header-anchor" href="#join-as-master" aria-label="Permalink to &quot;Join as Master&quot;">​</a></h2><p><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-alpha/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-alpha/</a></p><p>Certificate valid 2 hours</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> alpha</span><span style="color:#C3E88D;"> certs</span><span style="color:#C3E88D;"> certificate-key</span></span></code></pre></div><p>Before to start upload certificates in a master node</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> init</span><span style="color:#C3E88D;"> phase</span><span style="color:#C3E88D;"> upload-certs</span><span style="color:#C3E88D;"> --upload-certs</span></span>
<span class="line"><span style="color:#546E7A;font-style:italic;"># use this certificate-key</span></span></code></pre></div><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> join</span><span style="color:#C3E88D;"> cluster.ecs-cluster:6443</span><span style="color:#C3E88D;"> --token</span><span style="color:#C3E88D;"> wfdwcX.XXXXXXXXXXXXXXXX</span><span style="color:#EEFFFF;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">    --discovery-token-ca-cert-hash</span><span style="color:#C3E88D;"> sha256:4eb7daf656XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span><span style="color:#EEFFFF;"> \\</span></span>
<span class="line"><span style="color:#C3E88D;">    --control-plane</span><span style="color:#C3E88D;"> --certificate-key</span><span style="color:#C3E88D;"> d5ada6891029051XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span></code></pre></div>`,17),l=[t];function p(c,X,r,i,d,u){return a(),e("div",null,l)}const C=s(o,[["render",p]]);export{h as __pageData,C as default};
