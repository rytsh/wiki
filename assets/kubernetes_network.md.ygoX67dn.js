import{_ as s,o as a,c as n,R as p}from"./chunks/framework.07BXFssY.js";const B=JSON.parse('{"title":"Network","description":"","frontmatter":{},"headers":[],"relativePath":"kubernetes/network.md","filePath":"kubernetes/network.md","lastUpdated":1701821943000}'),l={name:"kubernetes/network.md"},o=p(`<h1 id="network" tabindex="-1">Network <a class="header-anchor" href="#network" aria-label="Permalink to &quot;Network&quot;">​</a></h1><p>Communication with IP, DNS and cluster networking.</p><h2 id="ip" tabindex="-1">IP <a class="header-anchor" href="#ip" aria-label="Permalink to &quot;IP&quot;">​</a></h2><p>Communication with other machine we need to same network or need a router</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#88846F;"># show devices</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span></span>
<span class="line"><span style="color:#88846F;"># show address</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> addr</span></span>
<span class="line"><span style="color:#88846F;"># add a new address</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> addr</span><span style="color:#E6DB74;"> add</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.1.10/24</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> eth0</span></span>
<span class="line"><span style="color:#88846F;"># for delete</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> addr</span><span style="color:#E6DB74;"> del</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.1.10/24</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> eth0</span></span></code></pre></div><p>When we go to other network our exit door is <strong>gateway</strong>, example our for <code>route</code> command</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">$</span><span style="color:#E6DB74;"> route</span></span>
<span class="line"><span style="color:#A6E22E;">Kernel</span><span style="color:#E6DB74;"> IP</span><span style="color:#E6DB74;"> routing</span><span style="color:#E6DB74;"> table</span></span>
<span class="line"><span style="color:#A6E22E;">Destination</span><span style="color:#E6DB74;">     Gateway</span><span style="color:#E6DB74;">         Genmask</span><span style="color:#E6DB74;">         Flags</span><span style="color:#E6DB74;"> Metric</span><span style="color:#E6DB74;"> Ref</span><span style="color:#E6DB74;">    Use</span><span style="color:#E6DB74;"> Iface</span></span>
<span class="line"><span style="color:#A6E22E;">default</span><span style="color:#E6DB74;">         _gateway</span><span style="color:#AE81FF;">        0.0</span><span style="color:#E6DB74;">.0.0</span><span style="color:#E6DB74;">         UG</span><span style="color:#AE81FF;">    0</span><span style="color:#AE81FF;">      0</span><span style="color:#AE81FF;">        0</span><span style="color:#E6DB74;"> ens37</span></span>
<span class="line"><span style="color:#A6E22E;">172.17.0.0</span><span style="color:#AE81FF;">      0.0</span><span style="color:#E6DB74;">.0.0</span><span style="color:#AE81FF;">         255.255</span><span style="color:#E6DB74;">.0.0</span><span style="color:#E6DB74;">     U</span><span style="color:#AE81FF;">     0</span><span style="color:#AE81FF;">      0</span><span style="color:#AE81FF;">        0</span><span style="color:#E6DB74;"> docker0</span></span>
<span class="line"><span style="color:#A6E22E;">172.18.0.0</span><span style="color:#AE81FF;">      0.0</span><span style="color:#E6DB74;">.0.0</span><span style="color:#AE81FF;">         255.255</span><span style="color:#E6DB74;">.0.0</span><span style="color:#E6DB74;">     U</span><span style="color:#AE81FF;">     0</span><span style="color:#AE81FF;">      0</span><span style="color:#AE81FF;">        0</span><span style="color:#E6DB74;"> br-5f56f9625c4c</span></span>
<span class="line"><span style="color:#A6E22E;">192.168.2.0</span><span style="color:#AE81FF;">     0.0</span><span style="color:#E6DB74;">.0.0</span><span style="color:#AE81FF;">         255.255</span><span style="color:#E6DB74;">.255.0</span><span style="color:#E6DB74;">   U</span><span style="color:#AE81FF;">     0</span><span style="color:#AE81FF;">      0</span><span style="color:#AE81FF;">        0</span><span style="color:#E6DB74;"> ens37</span></span>
<span class="line"><span style="color:#A6E22E;">192.168.39.0</span><span style="color:#AE81FF;">    0.0</span><span style="color:#E6DB74;">.0.0</span><span style="color:#AE81FF;">         255.255</span><span style="color:#E6DB74;">.255.0</span><span style="color:#E6DB74;">   U</span><span style="color:#AE81FF;">     0</span><span style="color:#AE81FF;">      0</span><span style="color:#AE81FF;">        0</span><span style="color:#E6DB74;"> virbr1</span></span>
<span class="line"><span style="color:#A6E22E;">192.168.122.0</span><span style="color:#AE81FF;">   0.0</span><span style="color:#E6DB74;">.0.0</span><span style="color:#AE81FF;">         255.255</span><span style="color:#E6DB74;">.255.0</span><span style="color:#E6DB74;">   U</span><span style="color:#AE81FF;">     0</span><span style="color:#AE81FF;">      0</span><span style="color:#AE81FF;">        0</span><span style="color:#E6DB74;"> virbr0</span></span></code></pre></div><p>But we need to declare gateway to reach specific network.<br> In here we want to go to <code>192.168.2.9/24</code> network but use <code>192.168.1.1</code>.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> route</span><span style="color:#E6DB74;"> add</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.2.0/24</span><span style="color:#E6DB74;"> via</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.1.1</span></span></code></pre></div><p>For other network we need to tell default gateway (you can use <code>0.0.0.0</code> instead of <code>default</code>)</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> route</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> default</span><span style="color:#E6DB74;"> via</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.2.1</span></span></code></pre></div><p>Delete route</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> route</span><span style="color:#E6DB74;"> del</span><span style="color:#E6DB74;"> default</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> route</span><span style="color:#E6DB74;"> del</span><span style="color:#AE81FF;"> 10.0</span><span style="color:#E6DB74;">.0.0/24</span><span style="color:#E6DB74;"> via</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.0.36</span></span></code></pre></div><p>When you reach to one machine to another of another machine, you need to declare route for related machines.<br> In linux machine ip forward disabled to prevent directly connect private network.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">cat</span><span style="color:#E6DB74;"> /proc/sys/net/ipv4/ip_forward</span></span>
<span class="line"><span style="color:#88846F;"># set change</span></span>
<span class="line"><span style="color:#66D9EF;">echo</span><span style="color:#AE81FF;"> 1</span><span style="color:#F92672;"> &gt;</span><span style="color:#E6DB74;"> /proc/sys/net/ipv4/ip_forward</span></span>
<span class="line"><span style="color:#88846F;"># persistent change in /etc/sysctl.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;">echo</span><span style="color:#E6DB74;">  net.ipv4.ip_forward</span><span style="color:#E6DB74;"> =</span><span style="color:#AE81FF;"> 1</span><span style="color:#F92672;"> &gt;&gt;</span><span style="color:#E6DB74;"> /etc/sysctl.conf</span></span>
<span class="line"><span style="color:#A6E22E;">sysctl</span><span style="color:#AE81FF;"> -p</span></span>
<span class="line"><span style="color:#A6E22E;">sysctl</span><span style="color:#AE81FF;"> -a</span><span style="color:#F92672;"> |</span><span style="color:#A6E22E;"> grep</span><span style="color:#E6DB74;"> net.ipv4.ip_forward</span></span></code></pre></div><p>Also look at the Metric variable for priority.</p><h2 id="network-namespaces" tabindex="-1">Network Namespaces <a class="header-anchor" href="#network-namespaces" aria-label="Permalink to &quot;Network Namespaces&quot;">​</a></h2><p>Create private network area to use in our app.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#88846F;"># red namespace add</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> red</span></span>
<span class="line"><span style="color:#88846F;"># blue namespace add</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> blue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># get namespaces</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> netns</span></span></code></pre></div><p>Run ip command in namespace</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> exec</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> ip</span><span style="color:#E6DB74;"> link</span></span>
<span class="line"><span style="color:#88846F;"># Or</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> link</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> arp</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> route</span></span></code></pre></div><p>Create virtual network</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> veth-red</span><span style="color:#E6DB74;"> type</span><span style="color:#E6DB74;"> veth</span><span style="color:#E6DB74;"> peer</span><span style="color:#E6DB74;"> name</span><span style="color:#E6DB74;"> veth-blue</span></span></code></pre></div><p>Veth create 2 paired network device. <a href="https://man7.org/linux/man-pages/man4/veth.4.html" target="_blank" rel="noreferrer">https://man7.org/linux/man-pages/man4/veth.4.html</a></p><p>Add virtual devices to namespaces</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-red</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> red</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-blue</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> blue</span></span></code></pre></div><p>Add an ip address</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> addr</span><span style="color:#E6DB74;"> add</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.1</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> veth-red</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> blue</span><span style="color:#E6DB74;"> addr</span><span style="color:#E6DB74;"> add</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.2</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> veth-blue</span></span></code></pre></div><p>up veth</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-red</span><span style="color:#E6DB74;"> up</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> blue</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-blue</span><span style="color:#E6DB74;"> up</span></span></code></pre></div><p>ping red to blue</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> exec</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> ping</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.2</span></span></code></pre></div><p>When delete one veth also it will delete own pair</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> veth-red</span></span></code></pre></div><h2 id="bridge" tabindex="-1">Bridge <a class="header-anchor" href="#bridge" aria-label="Permalink to &quot;Bridge&quot;">​</a></h2><p>Bridge work like switch.</p><p>Create bridge</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> v-net-0</span><span style="color:#E6DB74;"> type</span><span style="color:#E6DB74;"> bridge</span></span></code></pre></div><p>Check with <code>ip link</code></p><p>Up bridge</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> v-net-0</span><span style="color:#E6DB74;"> up</span></span></code></pre></div><p>Create 2 veth to link namespaces with bridge.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> veth-red</span><span style="color:#E6DB74;"> type</span><span style="color:#E6DB74;"> veth</span><span style="color:#E6DB74;"> peer</span><span style="color:#E6DB74;"> name</span><span style="color:#E6DB74;"> veth-red-br</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> veth-blue</span><span style="color:#E6DB74;"> type</span><span style="color:#E6DB74;"> veth</span><span style="color:#E6DB74;"> peer</span><span style="color:#E6DB74;"> name</span><span style="color:#E6DB74;"> veth-blue-br</span></span></code></pre></div><p>Add pairs to namespace and bridge.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-red</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> red</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-red-br</span><span style="color:#E6DB74;"> master</span><span style="color:#E6DB74;"> v-net-0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-blue</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> blue</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-blue-br</span><span style="color:#E6DB74;"> master</span><span style="color:#E6DB74;"> v-net-0</span></span></code></pre></div><p>Add ip address</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> addr</span><span style="color:#E6DB74;"> add</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.1</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> veth-red</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> blue</span><span style="color:#E6DB74;"> addr</span><span style="color:#E6DB74;"> add</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.2</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> veth-blue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># up</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> red</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-red</span><span style="color:#E6DB74;"> up</span></span>
<span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#AE81FF;"> -n</span><span style="color:#E6DB74;"> blue</span><span style="color:#E6DB74;"> link</span><span style="color:#E6DB74;"> set</span><span style="color:#E6DB74;"> veth-blue</span><span style="color:#E6DB74;"> up</span></span></code></pre></div><p>When reaching host to namespaces&#39; device we need to add ip address to bridge</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> addr</span><span style="color:#E6DB74;"> add</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.5/24</span><span style="color:#E6DB74;"> dev</span><span style="color:#E6DB74;"> v-net-0</span></span></code></pre></div><p>Now you can check</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ping</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.1</span></span></code></pre></div><p>When reaching namespace to other network</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">$</span><span style="color:#E6DB74;"> ip</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> exec</span><span style="color:#E6DB74;"> blue</span><span style="color:#E6DB74;"> ping</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.1.3</span></span>
<span class="line"><span style="color:#A6E22E;">Connect:</span><span style="color:#E6DB74;"> Network</span><span style="color:#E6DB74;"> is</span><span style="color:#E6DB74;"> unreachable</span></span></code></pre></div><p>You can not reach due to route not set</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> exec</span><span style="color:#E6DB74;"> blue</span><span style="color:#E6DB74;"> route</span></span></code></pre></div><p>Add route</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> exec</span><span style="color:#E6DB74;"> blue</span><span style="color:#E6DB74;"> ip</span><span style="color:#E6DB74;"> route</span><span style="color:#E6DB74;"> add</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.1.0/24</span><span style="color:#E6DB74;"> via</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.5</span></span></code></pre></div><p>But this time you can reach 192.168.1.0 but cannot get data Add nat</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">iptables</span><span style="color:#AE81FF;"> -t</span><span style="color:#E6DB74;"> nat</span><span style="color:#AE81FF;"> -A</span><span style="color:#E6DB74;"> POSTROUTING</span><span style="color:#AE81FF;"> -s</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.0/24</span><span style="color:#AE81FF;"> -j</span><span style="color:#E6DB74;"> MASQUERADE</span></span></code></pre></div><p>Now you can communicate</p><p>List Nat</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">iptables</span><span style="color:#AE81FF;"> -t</span><span style="color:#E6DB74;"> nat</span><span style="color:#AE81FF;"> -v</span><span style="color:#AE81FF;"> -L</span><span style="color:#AE81FF;"> -n</span><span style="color:#AE81FF;"> --line-number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">#delete a rule</span></span>
<span class="line"><span style="color:#A6E22E;">iptables</span><span style="color:#AE81FF;"> -t</span><span style="color:#E6DB74;"> nat</span><span style="color:#AE81FF;"> -D</span><span style="color:#E6DB74;"> POSTROUTING</span><span style="color:#E6DB74;"> {rule-number-here}</span></span></code></pre></div><p>But if you want to go to internet in namespace you need to add default route to namespace</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> netns</span><span style="color:#E6DB74;"> exec</span><span style="color:#E6DB74;"> blue</span><span style="color:#E6DB74;"> ip</span><span style="color:#E6DB74;"> route</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> default</span><span style="color:#E6DB74;"> via</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.5</span></span></code></pre></div><p>Now you can communicate with outside network<br> But if outside network need to communicate inside namespace</p><p>You can add route to outside machine but this is not useful so use port forwarding</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">ip</span><span style="color:#E6DB74;"> tables</span><span style="color:#AE81FF;"> -t</span><span style="color:#E6DB74;"> nat</span><span style="color:#AE81FF;"> -A</span><span style="color:#E6DB74;"> PREROUTING</span><span style="color:#AE81FF;"> --dport</span><span style="color:#AE81FF;"> 80</span><span style="color:#AE81FF;"> --to-destination</span><span style="color:#AE81FF;"> 192.168</span><span style="color:#E6DB74;">.15.2:80</span><span style="color:#AE81FF;"> -j</span><span style="color:#E6DB74;"> DNAT</span></span></code></pre></div><p>Any comming traffic in 80 goes to 192.168.15.2:80</p><p><a href="https://www.cyberciti.biz/tips/linux-iptables-examples.html" target="_blank" rel="noreferrer">https://www.cyberciti.biz/tips/linux-iptables-examples.html</a><br><a href="https://www.karlrupp.net/en/computer/nat_tutorial" target="_blank" rel="noreferrer">https://www.karlrupp.net/en/computer/nat_tutorial</a><br><a href="https://www.revsys.com/writings/quicktips/nat.html" target="_blank" rel="noreferrer">https://www.revsys.com/writings/quicktips/nat.html</a><br><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/security_guide/s1-firewall-ipt-fwd" target="_blank" rel="noreferrer">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/security_guide/s1-firewall-ipt-fwd</a></p>`,69),e=[o];function t(c,r,y,i,E,d){return a(),n("div",null,e)}const u=s(l,[["render",t]]);export{B as __pageData,u as default};
