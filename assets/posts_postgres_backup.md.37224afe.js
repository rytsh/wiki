import{_ as s,o as a,c as p,Q as o}from"./chunks/framework.362cc540.js";const g=JSON.parse('{"title":"Postgres Backup","description":"","frontmatter":{},"headers":[],"relativePath":"posts/postgres_backup.md","filePath":"posts/postgres_backup.md","lastUpdated":1700051936000}'),l={name:"posts/postgres_backup.md"},n=o(`<h1 id="postgres-backup" tabindex="-1">Postgres Backup <a class="header-anchor" href="#postgres-backup" aria-label="Permalink to &quot;Postgres Backup&quot;">​</a></h1><p>Add postgresql repos to apt sources, if you use ubuntu do like that:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;echo &quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list&#39;</span></span>
<span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-qO-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://www.postgresql.org/media/keys/ACCC4CF8.asc</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tee</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/apt/trusted.gpg.d/pgdg.asc</span><span style="color:#E1E4E8;"> &amp;</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">/dev/null</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;echo &quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-qO-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://www.postgresql.org/media/keys/ACCC4CF8.asc</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tee</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/apt/trusted.gpg.d/pgdg.asc</span><span style="color:#24292E;"> &amp;</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">/dev/null</span></span></code></pre></div><p>After that run <code>sudo apt update</code> and install postgresql-client, replace 15 with your postgresql version:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql-client-15</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql-client-15</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span></span></code></pre></div><h2 id="backup" tabindex="-1">Backup <a class="header-anchor" href="#backup" aria-label="Permalink to &quot;Backup&quot;">​</a></h2><p>Add <code>-Fc</code> option to restore with pg_restore, it will create a custom format dump file and we can use with pg_restore.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dbname=mydb</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Fc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--file=</span><span style="color:#9ECBFF;">&quot;mydb-dump.dmp&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dbname=mydb</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Fc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--file=</span><span style="color:#032F62;">&quot;mydb-dump.dmp&quot;</span></span></code></pre></div><h2 id="restore" tabindex="-1">Restore <a class="header-anchor" href="#restore" aria-label="Permalink to &quot;Restore&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pg_restore</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dbname=sonar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./mydb-dump.dmp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pg_restore</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dbname=sonar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./mydb-dump.dmp</span></span></code></pre></div>`,10),e=[n];function t(c,r,y,E,d,i){return a(),p("div",null,e)}const u=s(l,[["render",t]]);export{g as __pageData,u as default};
