import{_ as s,o as a,c as n,R as o}from"./chunks/framework.07BXFssY.js";const u=JSON.parse('{"title":"QEMU","description":"","frontmatter":{},"headers":[],"relativePath":"kubernetes/qemu.md","filePath":"kubernetes/qemu.md","lastUpdated":1701030096000}'),e={name:"kubernetes/qemu.md"},l=o(`<h1 id="qemu" tabindex="-1">QEMU <a class="header-anchor" href="#qemu" aria-label="Permalink to &quot;QEMU&quot;">​</a></h1><p>Qemu is perfect for creating virtual machines.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">sudo</span><span style="color:#E6DB74;"> apt-get</span><span style="color:#E6DB74;"> install</span><span style="color:#AE81FF;"> -y</span><span style="color:#E6DB74;"> qemu-system</span><span style="color:#E6DB74;"> ovmf</span></span></code></pre></div><p><a href="https://www.qemu.org/docs/master/system/qemu-manpage.html" target="_blank" rel="noreferrer">https://www.qemu.org/docs/master/system/qemu-manpage.html</a></p><h2 id="create-disk" tabindex="-1">Create Disk <a class="header-anchor" href="#create-disk" aria-label="Permalink to &quot;Create Disk&quot;">​</a></h2><p>qemu-img command to create qcow2 disk image, it will not allocate all space at once.</p><p><a href="https://linux.die.net/man/1/qemu-img" target="_blank" rel="noreferrer">https://linux.die.net/man/1/qemu-img</a></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">qemu-img</span><span style="color:#E6DB74;"> create</span><span style="color:#AE81FF;"> -f</span><span style="color:#E6DB74;"> qcow2</span><span style="color:#E6DB74;"> &quot;disk1.qcow2&quot;</span><span style="color:#E6DB74;"> &quot;1T&quot;</span></span></code></pre></div><h2 id="network" tabindex="-1">Network <a class="header-anchor" href="#network" aria-label="Permalink to &quot;Network&quot;">​</a></h2><p>Create a network card and attach it.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#F8F8F2;">PROFILE_IN_NETWORK_X1P1</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">&quot;,net=10.10.1.0/24,dhcpstart=10.10.1.20,ipv4&quot;</span></span></code></pre></div><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">-device</span><span style="color:#E6DB74;"> pci-bridge,id=pci.01,chassis_nr=</span><span style="color:#AE81FF;">1</span><span style="color:#E6DB74;">,addr=</span><span style="color:#AE81FF;">06</span><span style="color:#E6DB74;">,shpc=off</span></span>
<span class="line"><span style="color:#A6E22E;">-netdev</span><span style="color:#E6DB74;"> user,id=X1P1</span><span style="color:#F8F8F2;">\${PROFILE_IN_NETWORK_X1P1}</span></span>
<span class="line"><span style="color:#A6E22E;">-device</span><span style="color:#E6DB74;"> e1000,netdev=X1P1,bus=pci.01,mac=</span><span style="color:#AE81FF;">00</span><span style="color:#E6DB74;">:11:22:33:44:AA</span></span></code></pre></div><h2 id="port-forwarding" tabindex="-1">Port Forwarding <a class="header-anchor" href="#port-forwarding" aria-label="Permalink to &quot;Port Forwarding&quot;">​</a></h2><p>Add exra port forwarding option to netdev option.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">,hostfwd</span><span style="color:#F8F8F2;">=tcp:8822-:22</span></span></code></pre></div><h2 id="boot-from-iso" tabindex="-1">Boot from ISO <a class="header-anchor" href="#boot-from-iso" aria-label="Permalink to &quot;Boot from ISO&quot;">​</a></h2><p>Qemu to run iso file we need to add cd drive in our start script. Add bootindex=2 to make it boot from cd if bootindex=1 is not found.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">-device</span><span style="color:#E6DB74;"> ide-cd,drive=cdx,bootindex=</span><span style="color:#AE81FF;">2</span><span style="color:#AE81FF;"> -drive</span><span style="color:#E6DB74;"> if=none,id=cdx,file=./iso/netinstall.iso,cache=unsafe,format=raw</span><span style="color:#AE81FF;"> \\</span></span></code></pre></div><h2 id="start-qemu" tabindex="-1">Start Qemu <a class="header-anchor" href="#start-qemu" aria-label="Permalink to &quot;Start Qemu&quot;">​</a></h2><p>Usually you need to make a script to start qemu, and you can use virt-manager.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">qemu-system-x86_64</span><span style="color:#AE81FF;">  \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -machine</span><span style="color:#E6DB74;"> pc,accel=kvm</span><span style="color:#AE81FF;">           \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -cpu</span><span style="color:#E6DB74;"> host</span><span style="color:#AE81FF;">                       \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -m</span><span style="color:#AE81FF;"> 32</span><span style="color:#E6DB74;">G</span><span style="color:#AE81FF;">                          \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -enable-kvm</span><span style="color:#AE81FF;">                     \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -nodefaults</span><span style="color:#AE81FF;">                     \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -bios</span><span style="color:#E6DB74;"> /usr/share/ovmf/OVMF.fd</span><span style="color:#AE81FF;">   \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -device</span><span style="color:#E6DB74;"> pci-bridge,id=pci.01,chassis_nr=</span><span style="color:#AE81FF;">1</span><span style="color:#E6DB74;">,addr=</span><span style="color:#AE81FF;">06</span><span style="color:#E6DB74;">,shpc=off</span><span style="color:#AE81FF;"> -netdev</span><span style="color:#E6DB74;"> user,id=X1P1,net=</span><span style="color:#AE81FF;">10.10</span><span style="color:#E6DB74;">.1.0/24,dhcpstart=</span><span style="color:#AE81FF;">10.10</span><span style="color:#E6DB74;">.1.20,ipv4</span><span style="color:#AE81FF;"> -device</span><span style="color:#E6DB74;"> e1000,netdev=X1P1,bus=pci.01,mac=</span><span style="color:#AE81FF;">00</span><span style="color:#E6DB74;">:11:22:33:44:AA</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -vnc</span><span style="color:#E6DB74;"> :0</span><span style="color:#AE81FF;"> -k</span><span style="color:#E6DB74;"> en-us</span><span style="color:#AE81FF;"> -nographic</span><span style="color:#AE81FF;"> -vga</span><span style="color:#E6DB74;"> std</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -drive</span><span style="color:#E6DB74;"> if=none,id=disk1,file=/mnt/e/VM/disk1.qcow2,cache=unsafe</span><span style="color:#AE81FF;"> -device</span><span style="color:#E6DB74;"> ide-hd,drive=disk1,bootindex=</span><span style="color:#AE81FF;">1</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -watchdog</span><span style="color:#E6DB74;"> i6300esb</span><span style="color:#AE81FF;"> -watchdog-action</span><span style="color:#E6DB74;"> none</span><span style="color:#AE81FF;"> \\</span></span>
<span class="line"><span style="color:#AE81FF;">    -boot</span><span style="color:#E6DB74;"> menu=on,once=d</span></span></code></pre></div><h2 id="vnc" tabindex="-1">VNC <a class="header-anchor" href="#vnc" aria-label="Permalink to &quot;VNC&quot;">​</a></h2><p>You can use mobaxterm, tigervnc or any other vnc client to connect to qemu.<br> 5900 is the default port for qemu vnc.</p>`,23),p=[l];function t(c,r,i,d,y,E){return a(),n("div",null,p)}const h=s(e,[["render",t]]);export{u as __pageData,h as default};
