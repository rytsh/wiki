import{_ as n,o as a,c as o,ag as l}from"./chunks/framework.BcBuEkoe.js";const i=JSON.parse('{"title":"Database Connections","description":"","frontmatter":{},"headers":[],"relativePath":"development/go/database.md","filePath":"development/go/database.md","lastUpdated":1747736072000}'),p={name:"development/go/database.md"};function t(e,s,F,c,r,D){return a(),o("div",null,s[0]||(s[0]=[l(`<h1 id="database-connections" tabindex="-1">Database Connections <a class="header-anchor" href="#database-connections" aria-label="Permalink to &quot;Database Connections&quot;">â€‹</a></h1><table tabindex="0"><thead><tr><th>Driver</th><th>Library</th></tr></thead><tbody><tr><td>PostgreSQL</td><td>github.com/jackc/pgx/v5/stdlib</td></tr><tr><td>Oracle</td><td>github.com/godror/godror</td></tr></tbody></table><p>And database connection initialization use always connection max lifetime!<br> If you don&#39;t set it, connection could be closed by the database server and you will get an error when you try to use it on first time.</p><div class="language-go"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki material-theme vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">package</span><span style="color:#FFCB6B;"> database</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;"> (</span></span>
<span class="line"><span style="color:#89DDFF;">	&quot;</span><span style="color:#FFCB6B;">context</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">	&quot;</span><span style="color:#FFCB6B;">fmt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">	&quot;</span><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">	_ </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">github.com/jackc/pgx/v5/stdlib</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">	&quot;</span><span style="color:#FFCB6B;">github.com/jmoiron/sqlx</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">var</span><span style="color:#89DDFF;"> (</span></span>
<span class="line"><span style="color:#EEFFFF;">	ConnMaxLifetime </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 15</span><span style="color:#89DDFF;"> *</span><span style="color:#EEFFFF;"> time</span><span style="color:#89DDFF;">.</span><span style="color:#EEFFFF;">Minute</span></span>
<span class="line"><span style="color:#EEFFFF;">	MaxIdleConns    </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 3</span></span>
<span class="line"><span style="color:#EEFFFF;">	MaxOpenConns    </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 3</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#546E7A;font-style:italic;">// Connect attempts to connect to database server.</span></span>
<span class="line"><span style="color:#89DDFF;">func</span><span style="color:#82AAFF;"> Connect</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;font-style:italic;">ctx</span><span style="color:#FFCB6B;"> context</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">Context</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;font-style:italic;"> cfg</span><span style="color:#89DDFF;"> *</span><span style="color:#FFCB6B;">config</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">Config</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> (*</span><span style="color:#FFCB6B;">sqlx</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">DB</span><span style="color:#89DDFF;">,</span><span style="color:#C792EA;"> error</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#EEFFFF;">	db</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> err </span><span style="color:#89DDFF;">:=</span><span style="color:#EEFFFF;"> sqlx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ConnectContext</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> cfg</span><span style="color:#89DDFF;">.</span><span style="color:#EEFFFF;">DBType</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> cfg</span><span style="color:#89DDFF;">.</span><span style="color:#EEFFFF;">DBDataSource</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">	if</span><span style="color:#EEFFFF;"> err </span><span style="color:#89DDFF;">!=</span><span style="color:#89DDFF;"> nil</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		return</span><span style="color:#89DDFF;"> nil,</span><span style="color:#EEFFFF;"> fmt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Errorf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">failed to connect to database: </span><span style="color:#F07178;">%w</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> err</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">	db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SetConnMaxLifetime</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">ConnMaxLifetime</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#EEFFFF;">	db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SetMaxIdleConns</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">MaxIdleConns</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#EEFFFF;">	db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SetMaxOpenConns</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">MaxOpenConns</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">	return</span><span style="color:#EEFFFF;"> db</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> nil</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div>`,4)]))}const d=n(p,[["render",t]]);export{i as __pageData,d as default};
